<div class="row text-center m-20">
  <h3>Today's Absences</h3>
  <div class="text-muted">{{date}}</div>
</div>
<app-report-filters componentName="daily" (formAction)="onSubmit($event)"></app-report-filters>
<div class="row mt-30" *ngIf="noAbsenceMessage">
  <div class="alert-warning m-20 p-20">No Absences have been found.</div>
</div>
<div *ngIf="!noAbsenceMessage">
  <div class="row mt-30">
    <div class="col-md-4">
      <table>
        <tr>
          <td class="text-center">
            <h4>Total</h4>
            <canvas id="myChart" #chartTotal baseChart [legend]="false" width="150" height="100" [data]="totalAbsence"
              [colors]="totalChartColors" [labels]="['Total']" [chartType]="'doughnut'"
              [options]="chartOptions"></canvas>
            <div class="donut-inner">
              <h5>{{reportSummary.totalCount}}</h5>
            </div>
          </td>
          <td class="text-center">
            <h4>Filled</h4>
            <canvas #chartFilled baseChart [legend]="false" width="150" height="100" [data]="filledAbsence"
              [colors]="filledChartColors" [labels]="['Total', 'Filled']" [chartType]="'doughnut'"
              [options]="chartOptions"></canvas>
            <div class="donut-inner">
              <h5>{{reportSummary.filled}}</h5>
            </div>
          </td>
        </tr>
        <tr>
          <td class="text-center">
            <h4>Unfilled</h4>
            <canvas #chartUnFilled baseChart [legend]="false" width="150" height="100" [colors]="unFilledChartColors"
              [data]="unFilledAbsence" [labels]="['Unfilled', '']" [chartType]="'doughnut'"
              [options]="chartOptions"></canvas>
            <div class="donut-inner">
              <h5>{{reportSummary.unfilled}}</h5>
            </div>
          </td>
          <td class="text-center">
            <h4>No Sub Req</h4>
            <canvas #chartNoSubReq baseChart [legend]="false" width="150" height="100" [colors]="noSubReqChartColors"
              [data]="noSubReqAbsence" [labels]="['No Sub Req', '']" [chartType]="'doughnut'"
              [options]="chartOptions"></canvas>
            <div class="donut-inner">
              <h5>{{reportSummary.noSubRequired}}</h5>
            </div>
          </td>
        </tr>
      </table>
    </div>
    <div class="col-md-4">
      <canvas baseChart [chartType]="'bar'" [legend]="false" [data]="absenceSummary" [colors]="absenceSummaryColors" [options]="chartOptions" [labels]="['Filled', 'UnFilled', 'No Sub Required']"></canvas>
      <h4 class="report-summary-bar-chart-title">ABSENCES</h4>
    </div>
    <div class="col-md-4">
      <table>
        <td class="text-center">
          <canvas baseChart [chartType]="'doughnut'" [legend]="false" width="250" height="200" [data]="absenceSummary"
            [colors]="absenceSummaryColors" [labels]="['Filled', 'UnFilled', 'No Sub Required']"
            [options]="chartOptions"></canvas>
          <div class="donut-inner-for-fill-rate">
            <h5>{{reportSummary.filled / reportSummary.totalCount * 100 | number:'1.0-1'}}%</h5>
          </div>
          <div class="report-summary-donut-fillrate">Fill Rate</div>
        </td>
      </table>
    </div>
  </div>
  <div class="row">
    <mat-tab-group>
      <mat-tab label="Filled">
        <div class="m-30">
          <ngx-datatable class="material" [rows]="filledAbsenceDetails" [columnMode]="'standard'" [headerHeight]="50"
            [footerHeight]="50" [rowHeight]="'auto'" [limit]="8">
            <ngx-datatable-column [width]="260" name="Employee" prop="employeeName" [flexGrow]="2" cellClass="middle"
              [draggable]="false">
              <ng-template let-rowIndex="rowIndex" let-value="value" let-row="row" ngx-datatable-cell-template>
                <div class="ellipsis" [title]="value">
                  <strong>{{row['employeeName']}}</strong>
                  <br>
                  <span>{{ row['schoolName'] == null ? row['districtName'] : row['schoolName'] }}, {{ row['subject'] != null ? row['subject']
                    : 'N/A'}}, {{row['grade'] != null ? row['grade'] : 'N/A'}}</span>
                  <br>
                </div>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [width]="260" name="Date" [flexGrow]="2" cellClass="middle" [draggable]="false">
              <ng-template let-rowIndex="rowIndex" let-value="value" let-row="row" ngx-datatable-cell-template>
                <div class="ellipsis">{{ row['startDate'] | date:'E, M/d/y' }}</div>
                <div class="ellipsis" *ngIf="row['endDate']!=row['startDate']">{{ row['endDate'] | date:'E, M/d/y' }}
                </div>
                <div class="ellipsis">
                  {{ row['startTime'] | convertFrom24HourTo12HourFormat }}-{{ row['endTime'] | convertFrom24HourTo12HourFormat}}
                </div>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [width]="240" name="Status" [flexGrow]="2" cellClass="middle" [draggable]="false">
              <ng-template let-rowIndex="rowIndex" let-value="value" let-row="row" ngx-datatable-cell-template>
                <div class="ellipsis" *ngIf="row['absenceType']!=2">{{ row['statusTitle'] }}</div>
                <div class="ellipsis" *ngIf="row['absenceType']==2">Assigned</div>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [width]="260" name="Substitute" [flexGrow]="2" cellClass="middle" [draggable]="false">
              <ng-template let-rowIndex="rowIndex" let-value="value" let-row="row" ngx-datatable-cell-template>
                <div class="row">
                  <div class="col-md-1">
                    <img class="img-circle" [src]="getImage(row['substituteProfilePicUrl'])" width="25" height="25" />
                  </div>
                  <div class="col-md-8">
                    <div class="ellipsis">
                      {{ row['substituteName']}}
                    </div>
                  </div>
                </div>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Actions" [width]="150" [sortable]="false" [draggable]="false"
              [canAutoResize]="false">
              <ng-template let-rowIndex="rowIndex" let-id="value" let-row="row" ngx-datatable-cell-template>
                <button type="button" mat-icon-button color="primary" [disableRipple]="true"
                  (click)="reportDetails(row)">
                  <mat-icon>format_list_bulleted</mat-icon>
                </button>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </div>
      </mat-tab>
      <mat-tab label="UnFilled">
        <div class="m-30">
          <ngx-datatable id="dailyReports" class="material" [rows]="unFilledAbsenceDetails" [columnMode]="'standard'"
            [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'" [limit]="8">
            <ngx-datatable-column [width]="260" name="Employee" prop="employeeName" [flexGrow]="2" cellClass="middle"
              [draggable]="false">
              <ng-template let-rowIndex="rowIndex" let-value="value" let-row="row" ngx-datatable-cell-template>
                <div class="ellipsis" [title]="value">
                  <strong>{{row['employeeName']}}</strong>
                  <br>
                  <span>{{ row['schoolName'] == null ? row['districtName'] : row['schoolName'] }}, {{ row['subject'] != null ? row['subject']
                    : 'N/A'}}, {{row['grade'] != null ? row['grade'] : 'N/A'}}</span>
                  <br>
                </div>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [width]="260" name="Date" [flexGrow]="2" cellClass="middle" [draggable]="false">
              <ng-template let-rowIndex="rowIndex" let-value="value" let-row="row" ngx-datatable-cell-template>
                <div class="ellipsis">{{ row['startDate'] | date:'E, M/d/y' }}</div>
                <div class="ellipsis" *ngIf="row['endDate']!=row['startDate']">{{ row['endDate'] | date:'E, M/d/y' }}
                </div>
                <div class="ellipsis">
                  {{ row['startTime'] | convertFrom24HourTo12HourFormat }}-{{ row['endTime'] | convertFrom24HourTo12HourFormat}}
                </div>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [width]="240" name="Status" [flexGrow]="2" cellClass="middle" [draggable]="false">
              <ng-template let-rowIndex="rowIndex" let-value="value" let-row="row" ngx-datatable-cell-template>
                <div class="ellipsis">{{ row['statusTitle'] }}</div>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [width]="260" name="Substitute" [flexGrow]="2" cellClass="middle" [draggable]="false">
              <ng-template let-rowIndex="rowIndex" let-value="value" let-row="row" ngx-datatable-cell-template>
                N/A
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Actions" [width]="150" [sortable]="false" [draggable]="false"
              [canAutoResize]="false">
              <ng-template let-rowIndex="rowIndex" let-id="value" let-row="row" ngx-datatable-cell-template>
                <button type="button" mat-icon-button color="primary" [disableRipple]="true"
                  (click)="reportDetails(row)">
                  <mat-icon>format_list_bulleted</mat-icon>
                </button>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </div>
      </mat-tab>
      <mat-tab label="No Sub Req">
        <div class="m-30">
          <ngx-datatable class="material" [rows]="noSubReqAbsenceDetails" [columnMode]="'standard'" [headerHeight]="50"
            [footerHeight]="50" [rowHeight]="'auto'" [limit]="8">
            <ngx-datatable-column [width]="260" name="Employee" prop="employeeName" [flexGrow]="2" cellClass="middle"
              [draggable]="false">
              <ng-template let-rowIndex="rowIndex" let-value="value" let-row="row" ngx-datatable-cell-template>
                <div class="ellipsis" [title]="value">
                  <strong>{{row['employeeName']}}</strong>
                  <br>
                  <span>{{ row['schoolName'] == null ? row['districtName'] : row['schoolName'] }}, {{ row['subject'] != null ? row['subject']
                    : 'N/A'}}, {{row['grade'] != null ? row['grade'] : 'N/A'}}</span>
                  <br>
                </div>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [width]="260" name="Date" [flexGrow]="2" cellClass="middle" [draggable]="false">
              <ng-template let-rowIndex="rowIndex" let-value="value" let-row="row" ngx-datatable-cell-template>
                <div class="ellipsis">{{ row['startDate'] | date:'E, M/d/y' }}</div>
                <div class="ellipsis" *ngIf="row['endDate']!=row['startDate']">{{ row['endDate'] | date:'E, M/d/y' }}
                </div>
                <div class="ellipsis">
                  {{ row['startTime'] | convertFrom24HourTo12HourFormat }}-{{ row['endTime'] | convertFrom24HourTo12HourFormat}}
                </div>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [width]="240" name="Status" [flexGrow]="2" cellClass="middle" [draggable]="false">
              <ng-template let-rowIndex="rowIndex" let-value="value" let-row="row" ngx-datatable-cell-template>
                N/A
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [width]="260" name="Substitute" [flexGrow]="2" cellClass="middle" [draggable]="false">
              <ng-template let-rowIndex="rowIndex" let-value="value" let-row="row" ngx-datatable-cell-template>
                No Sub Required
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Actions" [width]="150" [sortable]="false" [draggable]="false"
              [canAutoResize]="false">
              <ng-template let-rowIndex="rowIndex" let-id="value" let-row="row" ngx-datatable-cell-template>
                <button type="button" mat-icon-button color="primary" [disableRipple]="true"
                  (click)="reportDetails(row)">
                  <mat-icon>format_list_bulleted</mat-icon>
                </button>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>